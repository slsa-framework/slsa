name: Migrate to Late Branch

on:
  workflow_dispatch: # Allows manual triggering of the workflow

permissions:
  contents: read # Minimum permission required to read the repository
  pull-requests: write # Required to create branches and push changes

jobs:
  migrate:
    runs-on: ubuntu-latest

    steps:
      - name: Check the tip of main
        uses: actions/checkout@v3
        with:
          ref: main # Checkout the main branch
          fetch-depth: 1 # We don't need the full history for this operation

      - name: Run migration script from clean version of main
        run: |
          chmod +x tools/migrate-to-late-branch.sh
          ./tools/migrate-to-late-branch.sh
